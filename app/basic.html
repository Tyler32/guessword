<!doctype html>
<html lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>

    <!-- Disable tap highlight on IE -->
    <meta name="msapplication-tap-highlight" content="no">

    <!-- Web Application Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Web Starter Kit">
    <link rel="icon" sizes="192x192" href="images/touch/chrome-touch-icon-192x192.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Web Starter Kit">
    <link rel="apple-touch-icon" href="images/touch/apple-touch-icon.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#2F3BA2">

    <!-- Color the status bar on mobile devices -->
    <meta name="theme-color" content="#2F3BA2">

    <!-- Include meta tag to ensure proper rendering and touch zooming -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Include jQuery Mobile stylesheets -->
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">

    <!-- Include the jQuery library -->
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

    <!-- Include the jQuery Mobile library -->
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>


    <link rel="stylesheet" href="/styles/main.css">

    <style>

        #top,
        #middle,
        #bottom {
            position: fixed;
            left: 0;
            right: 0;
        }

        #top {
            top: 0;
            height: 25%;
        }

        #middle {
            top: 25%;
            height: 25%;
        }

        #bottom {
            bottom: 0;
            overflow: auto;
            height: 50%;
        }

        .team-1-text{
            position:fixed;
            top:10px;
            left:10px;
        }

        .team-1-Btn{
            position:fixed;
            top:40px;
            left:10px;
        }

        .team-2-text {
            position:fixed;
            top:10px;
            right:10px;
        }

        .team-2-Btn {
            position:fixed;
            top:40px;
            right:10px;
        }

        .guesswordtext {
            text-align:center;
        }

        .startGameBtn {
            text-align:center;
        }

        .settings-Btn{
            text-align:center;
        }

    </style>

    <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
    <!--
    <link rel="canonical" href="http://www.example.com/">
    -->

</head>
<body>

<div id="top">
    <p class="team-1-text" id="team1Score">Team 1: 0</p>

    <div class="team-1-Btn">
        <a data-role="button" data-inline="true" onclick="team1BtnClick();" data-theme="b" id='team1Btn'>Add</a>
    </div>

    <div class="settings-Btn">
        <a data-role="button" data-inline="true" onclick="settingsBtnClick();" data-theme="b" id='settingsBtn'>Category</a>
    </div>

    <p class="team-2-text" id="team2Score">Team 2: 0</p>

    <div class="team-2-Btn">
        <a data-role="button" data-inline="true" onclick="team2BtnClick();" data-theme="b" id='team2Btn'>Add</a>
    </div>
</div>

<div id="middle">
    <p class="guesswordtext" id="wordToGuessText">GuessWord</p>

    <div class="startGameBtn">
        <a data-role="button" data-inline="true" onclick="theBtnToRuleThemAllClick();" data-theme="b" id='theBtnToRuleThemAll'>Start</a>
    </div>

    <p class="guesswordtext" id="categoryText"></p>
</div>

<div id="bottom">

    <form id="categoriesForm">
        <fieldset data-role="controlgroup">
            <legend>Categories:</legend>
            <input type="checkbox" name="checkbox-v-2b" id="checkbox-v-2b">
            <label for="checkbox-v-2b">DigiPen</label>
            <input type="checkbox" name="checkbox-v-2c" id="checkbox-v-2c">
            <label for="checkbox-v-2c">HarryPotter</label>
            <input type="checkbox" name="checkbox-v-2d" id="checkbox-v-2d">
            <label for="checkbox-v-2d">Characters</label>
            <input type="checkbox" name="checkbox-v-2e" id="checkbox-v-2e">
            <label for="checkbox-v-2e">College Sports</label>
            <input type="checkbox" name="checkbox-v-2f" id="checkbox-v-2f" checked="true">
            <label for="checkbox-v-2f">Final Fantasy</label>
            <input type="checkbox" name="checkbox-v-2g" id="checkbox-v-2g">
            <label for="checkbox-v-2g">LordOfTheRings</label>
            <input type="checkbox" name="checkbox-v-1" id="checkbox-v-1">
            <label for="checkbox-v-1">LOTR2</label>
            <input type="checkbox" name="checkbox-v-2" id="checkbox-v-2">
            <label for="checkbox-v-2">MoviesAndTV</label>
            <input type="checkbox" name="checkbox-v-3" id="checkbox-v-3">
            <label for="checkbox-v-3">Mythology</label>
            <input type="checkbox" name="checkbox-v-4" id="checkbox-v-4">
            <label for="checkbox-v-4">Naruto</label>
            <input type="checkbox" name="checkbox-v-5" id="checkbox-v-5">
            <label for="checkbox-v-5">Nintendo64</label>
            <input type="checkbox" name="checkbox-v-6" id="checkbox-v-6">
            <label for="checkbox-v-6">NintendoDS</label>
            <input type="checkbox" name="checkbox-v-7" id="checkbox-v-7">
            <label for="checkbox-v-7">NintendoEntertainmentSystem</label>
            <input type="checkbox" name="checkbox-v-8" id="checkbox-v-8">
            <label for="checkbox-v-8">NintendoGameCube</label>
            <input type="checkbox" name="checkbox-v-9" id="checkbox-v-9">
            <label for="checkbox-v-9">NintendoWii</label>
            <input type="checkbox" name="checkbox-v-10" id="checkbox-v-10">
            <label for="checkbox-v-10">North America Pro Sports</label>
            <input type="checkbox" name="checkbox-v-11" id="checkbox-v-11">
            <label for="checkbox-v-11">PC</label>
            <input type="checkbox" name="checkbox-v-12" id="checkbox-v-12">
            <label for="checkbox-v-12">Playstation</label>
            <input type="checkbox" name="checkbox-v-13" id="checkbox-v-13">
            <label for="checkbox-v-13">Playstation2</label>
            <input type="checkbox" name="checkbox-v-14" id="checkbox-v-14">
            <label for="checkbox-v-14">Playstation3</label>
            <input type="checkbox" name="checkbox-v-15" id="checkbox-v-15">
            <label for="checkbox-v-15">PlaystationPortable</label>
            <input type="checkbox" name="checkbox-v-16" id="checkbox-v-16">
            <label for="checkbox-v-16">Programming</label>
            <input type="checkbox" name="checkbox-v-17" id="checkbox-v-17">
            <label for="checkbox-v-17">Secret</label>
            <input type="checkbox" name="checkbox-v-18" id="checkbox-v-18">
            <label for="checkbox-v-18">SegaGenesis</label>
            <input type="checkbox" name="checkbox-v-19" id="checkbox-v-19">
            <label for="checkbox-v-19">SegaSaturn</label>
            <input type="checkbox" name="checkbox-v-20" id="checkbox-v-20">
            <label for="checkbox-v-20">StarWars</label>
            <input type="checkbox" name="checkbox-v-21" id="checkbox-v-21">
            <label for="checkbox-v-21">SuperNintendo</label>
            <input type="checkbox" name="checkbox-v-22" id="checkbox-v-22">
            <label for="checkbox-v-22">VideoGameStuff</label>
            <input type="checkbox" name="checkbox-v-23" id="checkbox-v-23">
            <label for="checkbox-v-23">XBox360</label>
            <input type="checkbox" name="checkbox-v-24" id="checkbox-v-24">
            <label for="checkbox-v-24">Marvel</label>
            <input type="checkbox" name="checkbox-v-25" id="checkbox-v-25">
            <label for="checkbox-v-25">MetalGear</label>
            <input type="checkbox" name="checkbox-v-26" id="checkbox-v-26">
            <label for="checkbox-v-26">Pokemon</label>
            <input type="checkbox" name="checkbox-v-27" id="checkbox-v-27">
            <label for="checkbox-v-27">ResidentEvil</label>

        </fieldset>
    </form>
</div>

<script>
    var guessWords = [];
    var team1Score = 0;
    var team2Score = 0;

    var beepIntervalId;
    var roundIntervalId;
    var midRoundIntervalId;
    var tenseIntervalId;
    var roundTime = 4500;

    var guessWordsIndex = 0;

    var endRoundAudio;
    var endGameAudio;
    var beepAudio;

    var timeoutId = 0;

    $(document).ready(function() {
        console.log("ready!");

        endRoundAudio = new Audio("/sounds/end.mp3");
        endGameAudio = new Audio("/sounds/endgame.wav");
        beepAudio = new Audio("/sounds/beep.wav");

        $('#theBtnToRuleThemAll').on("taphold", tappyTap);

        $('#categoryText').hide();

    });

    function tappyTap(){
        var btnText = $('#theBtnToRuleThemAll').text();
        console.log("btnText");
        if(btnText == 'Next') {
            endRound();
            $('#theBtnToRuleThemAll').text("Cancelled");
        }
    }

    //loadWords(['/categories/lotr.txt', '/categories/DigiPen.txt']);
    //loadWords(['http://localhost:63342/guessword/app/categories/lotr.txt', 'http://localhost:63342/guessword/app/categories/HarryPotter.txt']);
    //loadWords();//['http://localhost:63342/guessword/app/categories/lotr.txt', 'http://localhost:63342/guessword/app/categories/DigiPen.txt']);

    //$.ajax({
    //    url: "http://localhost:63342/guessword/app/categories/",
    //    success: function(data){
    //        $(data).each(function(){
    //            // will loop through
    //            console.log("Found a file: " + $(this).attr("href"));
    //        });
    //    }
    //});

    function loadWords() {
        var filePath = '/categories/';
        //var filePath = '/guesswordDebug/app/categories/';
        //var filePath = 'http://ternsts.com.s3-website-us-west-2.amazonaws.com/categories/';
        //var filePath = "http://localhost:63342/guessword/app/categories/";
        var files = [];
        guessWords = [];

        $('input[type=checkbox]').each(function () {
            if (this.checked) {
                var file = filePath + $(this).prev('label').text() + ".txt";
                console.log(file);
                files.push(file);
            }
        });


        $.each(files, function( index, value ) {
            console.log(value);
            $.ajax({
                url : value,
                type : "get",
                async: false,
                success : function(data) {
                    var words = data.split('\n');
                    var wordObj = [];
                    words.forEach( function (word) {
                        var cat = value.substring(value.lastIndexOf("/") + 1, value.lastIndexOf(".txt"));
                        wordObj.push({guessword: word, category: cat})
                    })
                    console.log(wordObj);
                    guessWords = $.merge(wordObj, guessWords);
                    console.log(guessWords);
                }
            });
        });

        guessWords = shuffle(guessWords);
        console.log(guessWords);
        guessWordsIndex = 0;
    };

    function theBtnToRuleThemAllClick(){
        console.log($('#theBtnToRuleThemAll').text());
        var btnText = $('#theBtnToRuleThemAll').text();

        if(btnText == 'Next') {
            var guesswordIndex = guessWordsIndex++ % guessWords.length;
            $('#wordToGuessText').prop('innerHTML', guessWords[guesswordIndex].guessword);
            $('#categoryText').prop('innerHTML', guessWords[guesswordIndex].category);
        }
        else if(btnText == 'Cancelled') {
            $('#theBtnToRuleThemAll').text("Next Round");
        }
        else {
            if(btnText == 'Start') {
                loadWords();

                if (guessWords.length == 0) {
                    $('#wordToGuessText').prop('innerHTML', 'Select Category');
                    return;
                }

                $('#team1Score').prop('innerHTML', "Team 1: 0");
                $('#team2Score').prop('innerHTML', "Team 2: 0");
            }

            //Round length 45-55 seconds
            roundTime = 45000 + Math.random() * 20000;
            beepAudio.play();
            endRoundAudio.volume = 0;
            endRoundAudio.play();
            beepIntervalId = setInterval(function() { beepAudio.play(); }, 1400);
            midRoundIntervalId = setInterval(function() {
                clearInterval(midRoundIntervalId);
                clearInterval(beepIntervalId);
                beepAudio.play();
                beepIntervalId = setInterval(function() { beepAudio.play(); }, 700);
            }, roundTime *.60);

            tenseIntervalId = setInterval(function() {
                clearInterval(tenseIntervalId);
                clearInterval(beepIntervalId);
                beepAudio.play();
                beepIntervalId = setInterval(function() { beepAudio.play(); }, 500);
            }, roundTime *.82);

            roundIntervalId = setInterval(endRound, roundTime);

            $('#theBtnToRuleThemAll').text("Next");
            var guesswordIndex = guessWordsIndex++ % guessWords.length;
            $('#wordToGuessText').prop('innerHTML', guessWords[guesswordIndex].guessword);
            $('#categoryText').prop('innerHTML', guessWords[guesswordIndex].category);
        }

    };

    function settingsBtnClick() {
        console.log("settingsBtnClick");

        $('#categoryText').toggle();
    }

    function team1BtnClick(){
        console.log("team1BtnClick")

        $('#team1Score').prop('innerHTML', "Team 1: " + ++team1Score);
        checkScores();
    };

    function team2BtnClick(){
        console.log("team2BtnClick")

        $('#team2Score').prop('innerHTML', "Team 2: " + ++team2Score);
        checkScores();
    };

    function endRound() {
        endRoundAudio.volume = 1;
        endRoundAudio.play();
        clearIntervals();

        $('#theBtnToRuleThemAll').text("Next Round");
    }

    function clearIntervals() {
        clearInterval(roundIntervalId);
        clearInterval(beepIntervalId);
        clearInterval(midRoundIntervalId);
        clearInterval(tenseIntervalId);
    }

    function checkScores() {
        var gameOver = false;
        if(team1Score >= 7) {
            gameOver = true;
            $('#wordToGuessText').prop('innerHTML', "Team 1 Wins!");

        }
        else if(team2Score >= 7) {
            gameOver = true;
            $('#wordToGuessText').prop('innerHTML', "Team 2 Wins!");
        }

        if(gameOver == true) {
            endGameAudio.play();
            $('#theBtnToRuleThemAll').text("Start");
            team1Score = 0;
            team2Score = 0;
            clearIntervals();
        }
    }

    function shuffle(array) {
        var currentIndex = array.length, temporaryValue, randomIndex;

        // While there remain elements to shuffle...
        while (0 !== currentIndex) {

            // Pick a remaining element...
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex -= 1;

            // And swap it with the current element.
            temporaryValue = array[currentIndex];
            array[currentIndex] = array[randomIndex];
            array[randomIndex] = temporaryValue;
        }

        return array;
    }

</script>

<!-- Google Analytics: change UA-XXXXX-X to be your site's ID -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-XXXXX-X', 'auto');
    ga('send', 'pageview');
</script>
<!-- Built with love using Web Starter Kit -->
</body>
</html>
